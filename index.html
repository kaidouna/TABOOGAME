<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaboGame - Multiplayer Word Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase App (core) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <!-- Firebase Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #333;
        }
        
        .container {
            width: 100%;
            max-width: 1000px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
        }
        
        /* Offline Role Selection Overlay */
        #offlineRoleOverlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            z-index: 99999;
        }
        
        #offlineRoleOverlay h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        
        #offlineRoleOverlay p {
            font-size: 1.2rem;
            max-width: 500px;
            text-align: center;
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        
        #offlineRoleOverlay .role-buttons {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        #offlineRoleOverlay button {
            padding: 1rem 2rem;
            font-size: 1.2rem;
            cursor: pointer;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 180px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        
        #offlineRoleOverlay .describer-btn {
            background: #f39c12;
            color: white;
        }
        
        #offlineRoleOverlay .describer-btn:hover {
            background: #e67e22;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(230, 126, 34, 0.4);
        }
        
        #offlineRoleOverlay .guesser-btn {
            background: #2ecc71;
            color: white;
        }
        
        #offlineRoleOverlay .guesser-btn:hover {
            background: #27ae60;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        
        header {
            background: linear-gradient(to right, #3498db, #2ecc71);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .settings-icon {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .settings-icon:hover {
            transform: rotate(45deg);
            background: rgba(255, 255, 255, 0.3);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .setup-screen {
            padding: 30px;
            text-align: center;
        }
        
        .setup-screen h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .input-group {
            margin: 20px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .input-group input {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.2rem;
            width: 300px;
            outline: none;
            text-align: center;
        }
        
        .role-selection {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .role-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            width: 220px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .role-card:hover {
            transform: translateY(-5px);
        }
        
        .role-card.selected {
            border: 3px solid #2ecc71;
            transform: scale(1.05);
        }
        
        .describer-card i {
            color: #f39c12;
        }
        
        .guesser-card i {
            color: #2ecc71;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary {
            background: #2ecc71;
            color: white;
        }
        
        .btn-secondary {
            background: #3498db;
            color: white;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        .game-screen {
            display: none;
            padding: 20px;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            background: #3498db;
            color: white;
            font-weight: bold;
        }
        
        .timer {
            font-size: 3rem;
            font-weight: bold;
            color: #e74c3c;
            margin: 20px 0;
            background: #fdedec;
            padding: 15px 30px;
            border-radius: 15px;
            text-align: center;
        }
        
        .describer-view, .guesser-view {
            display: none;
        }
        
        .words-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 30px 0;
            min-height: 200px;
        }
        
        .word-card {
            background: #3498db;
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 80px;
        }
        
        .word-card:hover {
            transform: scale(1.05);
        }
        
        .word-card.correct {
            background: #2ecc71;
        }
        
        .word-card.incorrect {
            background: #e74c3c;
        }
        
        .input-section {
            margin: 20px 0;
            text-align: center;
        }
        
        input {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.2rem;
            width: 300px;
            outline: none;
        }
        
        .score-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 20px 0;
            text-align: center;
        }
        
        .instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .role-switch-notice {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }
        
        /* Settings Modal */
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .settings-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }
        
        .settings-header h2 {
            color: #2c3e50;
        }
        
        .close-settings {
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .close-settings:hover {
            color: #34495e;
        }
        
        .setting-item {
            margin-bottom: 20px;
        }
        
        .setting-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .setting-item input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .setting-item .value-display {
            margin-top: 5px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .wordlist-section {
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .wordlist-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .wordlist-status {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .save-settings {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        
        .save-settings:hover {
            background: #27ae60;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #2ecc71;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1000;
        }
        
        .error-notification {
            background: #e74c3c;
        }
        
        .warning-notification {
            background: #f39c12;
        }
        
        .info-notification {
            background: #3498db;
        }
        
        .hotkey-hint {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .game-over-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            z-index: 1001;
            display: none;
            max-width: 400px;
            width: 90%;
        }
        
        .game-over-notification h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .game-over-notification p {
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        .game-over-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        /* Multiplayer specific styles */
        .mode-selection {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .mode-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            width: 220px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mode-card:hover {
            transform: translateY(-5px);
        }
        
        .mode-card.selected {
            border: 3px solid #2ecc71;
            transform: scale(1.05);
        }
        
        .solo-card i {
            color: #3498db;
        }
        
        .multiplayer-card i {
            color: #9b59b6;
        }
        
        .lobby-screen {
            display: none;
            padding: 30px;
            text-align: center;
        }
        
        .lobby-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .player-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .player-card {
            background: #3498db;
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            min-width: 120px;
        }
        
        .player-card.describer {
            background: #f39c12;
        }
        
        .player-card.guesser {
            background: #2ecc71;
        }
        
        .game-id-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 15px 0;
            padding: 10px;
            background: #f1c40f;
            border-radius: 10px;
            display: inline-block;
        }
        
        .copy-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .connection-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .connected {
            background: #2ecc71;
        }
        
        .disconnected {
            background: #e74c3c;
        }
        
        .multiplayer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .words-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .role-selection, .mode-selection {
                flex-direction: column;
                align-items: center;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            input {
                width: 100%;
            }
            
            #offlineRoleOverlay .role-buttons {
                flex-direction: column;
                gap: 1rem;
            }
            
            #offlineRoleOverlay h2 {
                font-size: 2rem;
            }
            
            .game-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .game-over-buttons {
                flex-direction: column;
            }
            
            .multiplayer-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Offline Role Selection Overlay -->
    <div id="offlineRoleOverlay">
        <h2>Select Your Role</h2>
        <p>Choose whether you want to describe words or guess them. You can change this later during the game.</p>
        <div class="role-buttons">
            <button class="describer-btn" onclick="setOfflineRole('describer')">
                <i class="fas fa-microphone-alt fa-2x"></i>
                Describer
            </button>
            <button class="guesser-btn" onclick="setOfflineRole('guesser')">
                <i class="fas fa-ear-listen fa-2x"></i>
                Guesser
            </button>
        </div>
        <p class="hotkey-hint">Press Enter to select your role</p>
    </div>
    
    <!-- Game Over Notification -->
    <div class="game-over-notification" id="game-over-notification">
        <h2>Game Over!</h2>
        <p id="game-over-message">Your score: 0 points</p>
        <div class="game-over-buttons">
            <button class="btn btn-primary" onclick="startNewGame()">Play Again</button>
            <button class="btn btn-secondary" onclick="returnToMenu()">Main Menu</button>
        </div>
    </div>
    
    <div class="container">
        <header>
            <div class="settings-icon" onclick="openSettings()">
                <i class="fas fa-cog"></i>
            </div>
            <h1>TABOGAME</h1>
            <p id="game-mode-header">Single Player Word Game</p>
        </header>
        
        <!-- Settings Modal -->
        <div class="settings-modal" id="settings-modal">
            <div class="settings-content">
                <div class="settings-header">
                    <h2>Game Settings</h2>
                    <div class="close-settings" onclick="closeSettings()">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
                
                <div class="setting-item">
                    <label for="rounds">Number of Rounds</label>
                    <input type="range" id="rounds" min="1" max="10" value="3" step="1">
                    <div class="value-display" id="rounds-value">3 rounds</div>
                </div>
                
                <div class="setting-item">
                    <label for="timer">Timer Duration (seconds)</label>
                    <input type="range" id="timer" min="30" max="180" value="90" step="10">
                    <div class="value-display" id="timer-value">90 seconds</div>
                </div>
                
                <div class="setting-item">
                    <label for="words">Number of Words</label>
                    <input type="range" id="words" min="5" max="30" value="20" step="5">
                    <div class="value-display" id="words-value">20 words</div>
                </div>
                
                <!-- Word List Section in Settings -->
                <div class="wordlist-section">
                    <h3>Word List Settings</h3>
                    <div class="wordlist-status" id="wordlist-status">
                        Using default word list (40 words)
                    </div>
                    <div class="input-group">
                        <input type="file" id="word-file" accept=".txt">
                        <button class="btn btn-primary btn-small" onclick="loadWordList()">Load Custom Words</button>
                        <button class="btn btn-secondary btn-small" onclick="useDefaultWords()">Use Default Words</button>
                    </div>
                </div>
                
                <button class="save-settings" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
        
        <!-- Notification -->
        <div class="notification" id="notification">
            Settings saved successfully!
        </div>
        
        <!-- Mode Selection Screen -->
        <div class="setup-screen" id="mode-screen">
            <h2>Select Game Mode</h2>
            <div class="mode-selection">
                <div class="mode-card solo-card" onclick="selectMode('solo')">
                    <i class="fas fa-user fa-3x"></i>
                    <h3>Single Player</h3>
                    <p>Play by yourself switching roles</p>
                </div>
                
                <div class="mode-card multiplayer-card" onclick="selectMode('multiplayer')">
                    <i class="fas fa-users fa-3x"></i>
                    <h3>Multiplayer</h3>
                    <p>Play with friends online</p>
                </div>
            </div>
            <p class="hotkey-hint">Press Enter to continue</p>
            <button class="btn btn-primary" onclick="submitMode()">Continue</button>
        </div>
        
        <!-- Player Name Screen -->
        <div class="setup-screen" id="name-screen" style="display: none;">
            <h2>Enter Your NickName</h2>
            <div class="input-group">
                <input type="text" id="player-name" placeholder="Your name" maxlength="15">
                <p class="hotkey-hint">Press Enter to continue</p>
            </div>
            
            <button class="btn btn-primary" onclick="submitName()">Continue</button>
            <button class="btn btn-secondary" onclick="switchScreen('mode-screen')">Back</button>
        </div>
        
        <!-- Multiplayer Lobby Screen -->
        <div class="lobby-screen" id="lobby-screen">
            <h2>Multiplayer Lobby</h2>
            
            <div class="lobby-info">
                <h3>Game ID: <span id="game-id-display">Loading...</span></h3>
                <button class="copy-btn" onclick="copyGameId()"><i class="fas fa-copy"></i> Copy</button>
                <p>Share this code with your friends so they can join your game</p>
            </div>
            
            <div class="input-group" id="join-section" style="display: none;">
                <input type="text" id="join-game-id" placeholder="Enter Game ID">
                <button class="btn btn-primary" onclick="joinGame()">Join Game</button>
            </div>
            
            <h3>Players in Lobby:</h3>
            <div class="player-list" id="player-list">
                <!-- Players will be added here dynamically -->
            </div>
            
            <div class="multiplayer-controls" id="host-controls" style="display: none;">
                <button class="btn btn-primary" onclick="startMultiplayerGame()">Start Game</button>
                <button class="btn btn-danger" onclick="leaveGame()">Leave Game</button>
            </div>
            
            <div class="multiplayer-controls" id="guest-controls" style="display: none;">
                <button class="btn btn-danger" onclick="leaveGame()">Leave Game</button>
            </div>
            
            <div id="waiting-message" style="display: none;">
                <p>Waiting for host to start the game...</p>
            </div>
        </div>
        
        <!-- Role Selection Screen -->
        <div class="setup-screen" id="role-screen" style="display: none;">
            <h2>Select Your Role</h2>
            <div class="role-selection">
                <div class="role-card describer-card" onclick="selectRole('describer')">
                    <i class="fas fa-microphone-alt fa-3x"></i>
                    <h3>Describer</h3>
                    <p>See words and describe them</p>
                </div>
                
                <div class="role-card guesser-card" onclick="selectRole('guesser')">
                    <i class="fas fa-ear-listen fa-3x"></i>
                    <h3>Guesser</h3>
                    <p>Listen and guess words</p>
                </div>
            </div>
            <p class="hotkey-hint">Press Enter to continue</p>
            <button class="btn btn-primary" onclick="submitRole()">Continue</button>
            <button class="btn btn-secondary" onclick="switchScreen('name-screen')">Back</button>
        </div>
        
        <!-- Game Screen -->
        <div class="game-screen" id="game-screen">
            <div class="game-header">
                <span id="player-info">Player Name - Role</span>
                <div>
                    <button class="btn btn-warning" onclick="switchRole()">Switch Role</button>
                    <button class="btn btn-danger" onclick="resetGame()">Reset Game</button>
                </div>
            </div>
            
            <div class="timer" id="timer-display">90s</div>
            
            <div class="describer-view" id="describer-view">
                <h2>Describe words to your team</h2>
                <p>Click "Start Game" to begin. Words will appear after you start.</p>
                
                <div class="words-grid" id="words-grid" style="display: none;">
                    <!-- Words will be dynamically inserted here -->
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="start-button" onclick="startGame()">Start Game</button>
                </div>
            </div>
            
            <div class="guesser-view" id="guesser-view">
                <h2>Listen to your team's descriptions</h2>
                <p>Type the word you think is being described</p>
                
                <div class="input-section">
                    <input type="text" id="guess-input" placeholder="Type your guess here...">
                    <p class="hotkey-hint">Press Enter to submit</p>
                    <button class="btn btn-primary" onclick="submitGuess()">Submit</button>
                </div>
                
                <div class="score-display">
                    Score: <span id="score">0</span> points
                </div>
                
                <div class="role-switch-notice" id="role-switch-notice" style="display: none;">
                    <i class="fas fa-info-circle"></i> You switched roles. The game continues.
                </div>
                
                <div class="words-grid" id="guessed-words">
                    <!-- Correctly guessed words will appear here -->
                </div>
            </div>
            
            <div class="instructions">
                <h3>Game Instructions</h3>
                <ul>
                    <li><strong>Describers:</strong> Describe words without saying the word itself</li>
                    <li><strong>Guessers:</strong> Type the word you think is being described</li>
                    <li>You have <span id="settings-timer">90</span> seconds to guess as many words as possible</li>
                    <li>Each correct guess is worth 10 points</li>
                    <li>Game consists of <span id="settings-rounds">3</span> rounds with <span id="settings-words">20</span> words each</li>
                    <li>Use the "Switch Role" button to change between Describer and Guesser</li>
                </ul>
            </div>
        </div>
    </div>
    <script>
        // Firebase configuration - Replace with your own config
        const firebaseConfig = {
            apiKey: "AIzaSyDU0kEXnU1z5hUJ8P7u4s0MxGvGp3pYV4E",
            authDomain: "tabogame-online.firebaseapp.com",
            databaseURL: "https://tabogame-online-default-rtdb.firebaseio.com",
            projectId: "tabogame-online",
            storageBucket: "tabogame-online.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdefghijklmnopqrstuv"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Game state
        let gameActive = false;
        let timeLeft = 90;
        let timerInterval = null;
        let currentWords = [];
        let guessedWords = [];
        let score = 0;
        let playerName = '';
        let playerRole = '';
        let gameMode = 'solo'; // 'solo' or 'multiplayer'
        let gameId = null;
        let isHost = false;
        let playerId = null;
        let gameRef = null;
        let playersRef = null;
        
        // Game settings with default values
        let gameSettings = {
            rounds: 3,
            timerDuration: 90,
            wordCount: 20
        };
        
        // Default word list
        const defaultWords = [
            "apple", "banana", "orange", "grape", "melon",
            "computer", "keyboard", "mouse", "monitor", "laptop",
            "river", "mountain", "forest", "ocean", "desert",
            "book", "pencil", "paper", "teacher", "student",
            "sun", "moon", "star", "planet", "galaxy",
            "pizza", "burger", "pasta", "salad", "soup",
            "car", "bicycle", "train", "airplane", "ship",
            "dog", "cat", "bird", "fish", "rabbit"
        ];
        
        // DOM elements
        const nameScreen = document.getElementById('name-screen');
        const roleScreen = document.getElementById('role-screen');
        const gameScreen = document.getElementById('game-screen');
        const describerView = document.getElementById('describer-view');
        const guesserView = document.getElementById('guesser-view');
        const timerEl = document.getElementById('timer-display');
        const wordsGridEl = document.getElementById('words-grid');
        const guessedWordsEl = document.getElementById('guessed-words');
        const scoreEl = document.getElementById('score');
        const guessInput = document.getElementById('guess-input');
        const playerInfoEl = document.getElementById('player-info');
        const startButton = document.getElementById('start-button');
        const roleSwitchNotice = document.getElementById('role-switch-notice');
        const settingsModal = document.getElementById('settings-modal');
        const notification = document.getElementById('notification');
        const offlineRoleOverlay = document.getElementById('offlineRoleOverlay');
        const gameOverNotification = document.getElementById('game-over-notification');
        const gameOverMessage = document.getElementById('game-over-message');
        const wordlistStatus = document.getElementById('wordlist-status');
        const modeScreen = document.getElementById('mode-screen');
        const lobbyScreen = document.getElementById('lobby-screen');
        const gameIdDisplay = document.getElementById('game-id-display');
        const playerList = document.getElementById('player-list');
        const hostControls = document.getElementById('host-controls');
        const guestControls = document.getElementById('guest-controls');
        const joinSection = document.getElementById('join-section');
        const waitingMessage = document.getElementById('waiting-message');
        const joinGameIdInput = document.getElementById('join-game-id');
        const gameModeHeader = document.getElementById('game-mode-header');
        
        // Generate a unique player ID
        function generatePlayerId() {
            return 'player-' + Math.random().toString(36).substr(2, 9);
        }
        
        // Initialize settings sliders and use default words
        function initSettings() {
            const roundsSlider = document.getElementById('rounds');
            const timerSlider = document.getElementById('timer');
            const wordsSlider = document.getElementById('words');
            const roundsValue = document.getElementById('rounds-value');
            const timerValue = document.getElementById('timer-value');
            const wordsValue = document.getElementById('words-value');
            
            // Set initial values
            roundsSlider.value = gameSettings.rounds;
            timerSlider.value = gameSettings.timerDuration;
            wordsSlider.value = gameSettings.wordCount;
            
            // Update displays
            roundsValue.textContent = `${gameSettings.rounds} rounds`;
            timerValue.textContent = `${gameSettings.timerDuration} seconds`;
            wordsValue.textContent = `${gameSettings.wordCount} words`;
            
            // Add event listeners
            roundsSlider.addEventListener('input', function() {
                roundsValue.textContent = `${this.value} rounds`;
            });
            
            timerSlider.addEventListener('input', function() {
                timerValue.textContent = `${this.value} seconds`;
            });
            
            wordsSlider.addEventListener('input', function() {
                wordsValue.textContent = `${this.value} words`;
            });
            
            // Use default words initially
            currentWords = [...defaultWords];
            wordlistStatus.textContent = `Using default word list (${currentWords.length} words)`;
            
            // Update instructions
            updateInstructions();
        }
        
        // Update instructions with current settings
        function updateInstructions() {
            document.getElementById('settings-timer').textContent = gameSettings.timerDuration;
            document.getElementById('settings-rounds').textContent = gameSettings.rounds;
            document.getElementById('settings-words').textContent = gameSettings.wordCount;
        }
        
        // Open settings modal
        function openSettings() {
            settingsModal.style.display = 'flex';
        }
        
        // Close settings modal
        function closeSettings() {
            settingsModal.style.display = 'none';
        }
        
        // Save settings
        function saveSettings() {
            const roundsSlider = document.getElementById('rounds');
            const timerSlider = document.getElementById('timer');
            const wordsSlider = document.getElementById('words');
            
            gameSettings.rounds = parseInt(roundsSlider.value);
            gameSettings.timerDuration = parseInt(timerSlider.value);
            gameSettings.wordCount = parseInt(wordsSlider.value);
            
            // Update timer display if game is not active
            if (!gameActive) {
                timeLeft = gameSettings.timerDuration;
                timerEl.textContent = `${timeLeft}s`;
            }
            
            // Update instructions
            updateInstructions();
            
            // Show notification
            showNotification('Settings saved successfully!');
            
            // Close modal
            closeSettings();
        }
        
        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            
            if (type === 'error') {
                notification.classList.add('error-notification');
            } else if (type === 'warning') {
                notification.classList.add('warning-notification');
            } else if (type === 'info') {
                notification.classList.add('info-notification');
            }
            
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Switch between setup screens
        function switchScreen(screenId) {
            nameScreen.style.display = 'none';
            roleScreen.style.display = 'none';
            gameScreen.style.display = 'none';
            modeScreen.style.display = 'none';
            lobbyScreen.style.display = 'none';
            
            document.getElementById(screenId).style.display = 'block';
        }
        
        // Select game mode
        function selectMode(mode) {
            gameMode = mode;
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`.${mode}-card`).classList.add('selected');
        }
        
        // Submit mode selection
        function submitMode() {
            if (!gameMode) {
                showNotification('Please select a game mode', 'error');
                return;
            }
            
            if (gameMode === 'multiplayer') {
                // Generate player ID
                playerId = generatePlayerId();
                switchScreen('name-screen');
            } else {
                switchScreen('name-screen');
            }
        }
        
        // Submit player name
        function submitName() {
            playerName = document.getElementById('player-name').value.trim();
            if (!playerName) {
                showNotification('Please enter your name', 'error');
                return;
            }
            
            if (gameMode === 'multiplayer') {
                // Show multiplayer lobby screen
                switchScreen('lobby-screen');
                createOrJoinMultiplayerGame();
            } else {
                switchScreen('role-screen');
            }
        }
        
        // Create or join multiplayer game
        function createOrJoinMultiplayerGame() {
            // If we have a game ID in the URL, join that game
            const urlParams = new URLSearchParams(window.location.search);
            const joinGameId = urlParams.get('join');
            
            if (joinGameId) {
                joinGameIdInput.value = joinGameId;
                joinGame();
            } else {
                createGame();
            }
        }
        
        // Create a new multiplayer game
        function createGame() {
            // Generate a random game ID
            gameId = Math.random().toString(36).substring(2, 8).toUpperCase();
            
            // Update URL with game ID
            window.history.replaceState({}, document.title, `${window.location.pathname}?game=${gameId}`);
            
            // Set up Firebase references
            gameRef = database.ref(`games/${gameId}`);
            playersRef = database.ref(`games/${gameId}/players`);
            
            // Set game data
            gameRef.set({
                settings: gameSettings,
                status: 'waiting',
                currentWords: [],
                guessedWords: [],
                score: 0,
                timeLeft: gameSettings.timerDuration,
                gameActive: false,
                host: playerId
            });
            
            // Add player to the game
            addPlayerToGame();
            
            // Set up game listeners
            setupGameListeners();
            
            // Show host controls
            isHost = true;
            hostControls.style.display = 'flex';
            guestControls.style.display = 'none';
            joinSection.style.display = 'none';
            gameIdDisplay.textContent = gameId;
        }
        
        // Join an existing multiplayer game
        function joinGame() {
            const joinId = joinGameIdInput.value.trim().toUpperCase();
            
            if (!joinId) {
                showNotification('Please enter a game ID', 'error');
                return;
            }
            
            gameId = joinId;
            
            // Update URL with game ID
            window.history.replaceState({}, document.title, `${window.location.pathname}?join=${gameId}`);
            
            // Set up Firebase references
            gameRef = database.ref(`games/${gameId}`);
            playersRef = database.ref(`games/${gameId}/players`);
            
            // Check if game exists
            gameRef.once('value').then(snapshot => {
                if (snapshot.exists()) {
                    const gameData = snapshot.val();
                    
                    if (gameData.status === 'waiting') {
                        // Add player to the game
                        addPlayerToGame();
                        
                        // Set up game listeners
                        setupGameListeners();
                        
                        // Show guest controls
                        isHost = false;
                        hostControls.style.display = 'none';
                        guestControls.style.display = 'flex';
                        joinSection.style.display = 'none';
                        waitingMessage.style.display = 'block';
                        gameIdDisplay.textContent = gameId;
                    } else {
                        showNotification('Game is already in progress', 'error');
                    }
                } else {
                    showNotification('Game not found', 'error');
                }
            });
        }
        
        // Add player to the multiplayer game
        function addPlayerToGame() {
            // Add player to players list
            playersRef.child(playerId).set({
                name: playerName,
                role: '',
                score: 0,
                connected: true
            });
            
            // Set up disconnect handler
            playersRef.child(playerId).onDisconnect().update({
                connected: false
            });
        }
        
        // Set up multiplayer game listeners
        function setupGameListeners() {
            // Listen for game state changes
            gameRef.on('value', snapshot => {
                const gameData = snapshot.val();
                if (!gameData) return;
                
                if (gameData.status === 'playing') {
                    // Game is active, update local state
                    currentWords = gameData.currentWords || [];
                    guessedWords = gameData.guessedWords || [];
                    score = gameData.score || 0;
                    timeLeft = gameData.timeLeft || gameSettings.timerDuration;
                    gameActive = gameData.gameActive || false;
                    
                    // Update UI
                    scoreEl.textContent = score;
                    timerEl.textContent = `${timeLeft}s`;
                    
                    // If game is active but we're not in game screen, switch to it
                    if (gameScreen.style.display !== 'block') {
                        switchScreen('game-screen');
                        initializeGameUI();
                    }
                    
                    // Update words grid if we're the describer
                    if (playerRole === 'describer' && wordsGridEl.style.display !== 'grid') {
                        wordsGridEl.style.display = 'grid';
                        populateWordsGrid();
                    }
                    
                    // Update guessed words if we're the guesser
                    if (playerRole === 'guesser') {
                        updateGuessedWords();
                    }
                    
                    // Start timer if needed
                    if (gameActive && !timerInterval) {
                        startTimer();
                    }
                } else if (gameData.status === 'finished') {
                    // Game is over
                    endGame();
                }
            });
            
            // Listen for player changes
            playersRef.on('value', snapshot => {
                const players = snapshot.val();
                if (!players) return;
                
                // Update player list UI
                updatePlayerList(players);
                
                // Check if we need to assign a role
                if (!playerRole) {
                    // Auto-assign roles if needed
                    let describers = 0;
                    let guessers = 0;
                    
                    for (const id in players) {
                        if (players[id].role === 'describer') describers++;
                        if (players[id].role === 'guesser') guessers++;
                    }
                    
                    // Assign role based on what's needed
                    if (describers === 0) {
                        playerRole = 'describer';
                        playersRef.child(playerId).update({ role: 'describer' });
                    } else if (guessers === 0) {
                        playerRole = 'guesser';
                        playersRef.child(playerId).update({ role: 'guesser' });
                    } else {
                        // Randomly assign role
                        playerRole = Math.random() < 0.5 ? 'describer' : 'guesser';
                        playersRef.child(playerId).update({ role: playerRole });
                    }
                    
                    // Update UI
                    playerInfoEl.textContent = `${playerName} - ${playerRole.charAt(0).toUpperCase() + playerRole.slice(1)}`;
                    
                    if (playerRole === 'describer') {
                        describerView.style.display = 'block';
                        guesserView.style.display = 'none';
                    } else {
                        describerView.style.display = 'none';
                        guesserView.style.display = 'block';
                    }
                }
            });
        }
        
        // Update player list UI
        function updatePlayerList(players) {
            playerList.innerHTML = '';
            
            for (const id in players) {
                const player = players[id];
                const playerCard = document.createElement('div');
                playerCard.className = `player-card ${player.role}`;
                
                const statusClass = player.connected ? 'connected' : 'disconnected';
                
                playerCard.innerHTML = `
                    <span class="connection-status ${statusClass}"></span>
                    ${player.name} 
                    <br><small>${player.role ? player.role : 'unassigned'}</small>
                `;
                
                playerList.appendChild(playerCard);
            }
        }
        
        // Start multiplayer game
        function startMultiplayerGame() {
            if (!isHost) return;
            
            // Generate words for the game
            const gameWords = [...currentWords]
                .sort(() => 0.5 - Math.random())
                .slice(0, gameSettings.wordCount);
            
            // Update game state
            gameRef.update({
                status: 'playing',
                gameActive: true,
                currentWords: gameWords,
                guessedWords: [],
                score: 0,
                timeLeft: gameSettings.timerDuration
            });
            
            // Hide waiting message
            waitingMessage.style.display = 'none';
        }
        
        // Leave multiplayer game
        function leaveGame() {
            if (gameRef) {
                // Remove player from game
                playersRef.child(playerId).remove();
                
                // If host, delete the game when all players leave
                if (isHost) {
                    gameRef.once('value').then(snapshot => {
                        const gameData = snapshot.val();
                        if (gameData && gameData.players) {
                            const players = Object.keys(gameData.players);
                            if (players.length === 0) {
                                gameRef.remove();
                            }
                        }
                    });
                }
                
                // Clean up Firebase listeners
                gameRef.off();
                playersRef.off();
            }
            
            // Return to mode selection
            switchScreen('mode-screen');
        }
        
        // Copy game ID to clipboard
        function copyGameId() {
            const gameLink = `${window.location.origin}${window.location.pathname}?join=${gameId}`;
            
            navigator.clipboard.writeText(gameLink).then(() => {
                showNotification('Game link copied to clipboard!');
            }).catch(err => {
                showNotification('Failed to copy game link', 'error');
            });
        }
        
        // Select role
        function selectRole(role) {
            playerRole = role;
            document.querySelectorAll('.role-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`.${role}-card`).classList.add('selected');
        }
        
        // Submit role selection
        function submitRole() {
            if (!playerRole) {
                showNotification('Please select a role', 'error');
                return;
            }
            initializeGame();
        }
        
        // Load word list from file
        function loadWordList() {
            const fileInput = document.getElementById('word-file');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('Please select a file', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const contents = e.target.result;
                const loadedWords = contents.split('\n')
                    .map(word => word.trim())
                    .filter(word => word.length > 0);
                
                if (loadedWords.length < gameSettings.wordCount) {
                    showNotification(`Your word list has only ${loadedWords.length} words. We need at least ${gameSettings.wordCount} words.`, 'warning');
                    return;
                }
                
                currentWords = loadedWords;
                wordlistStatus.textContent = `Using custom word list (${currentWords.length} words)`;
                showNotification(`Custom word list loaded with ${currentWords.length} words`);
            };
            reader.readAsText(file);
        }
        
        // Use default words
        function useDefaultWords() {
            currentWords = [...defaultWords];
            wordlistStatus.textContent = `Using default word list (${currentWords.length} words)`;
            showNotification('Default word list loaded');
        }
        
        // Initialize the game
        function initializeGame() {
            // Update UI with player info
            playerInfoEl.textContent = `${playerName} - ${playerRole.charAt(0).toUpperCase() + playerRole.slice(1)}`;
            
            // Show the appropriate view based on role
            if (playerRole === 'describer') {
                describerView.style.display = 'block';
                guesserView.style.display = 'none';
                wordsGridEl.style.display = 'none';
            } else {
                describerView.style.display = 'none';
                guesserView.style.display = 'block';
            }
            
            // Update header based on game mode
            gameModeHeader.textContent = gameMode === 'multiplayer' ? 'Multiplayer Word Game' : 'Single Player Word Game';
            
            // Reset game state
            gameActive = false;
            score = 0;
            guessedWords = [];
            scoreEl.textContent = score;
            guessedWordsEl.innerHTML = '';
            timeLeft = gameSettings.timerDuration;
            timerEl.textContent = `${timeLeft}s`;
            
            // Clear any existing timer
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Reset start button
            startButton.disabled = false;
            startButton.textContent = 'Start Game';
            
            switchScreen('game-screen');
        }
        
        // Initialize game UI (for multiplayer)
        function initializeGameUI() {
            // Update UI with player info
            playerInfoEl.textContent = `${playerName} - ${playerRole.charAt(0).toUpperCase() + playerRole.slice(1)}`;
            
            // Show the appropriate view based on role
            if (playerRole === 'describer') {
                describerView.style.display = 'block';
                guesserView.style.display = 'none';
            } else {
                describerView.style.display = 'none';
                guesserView.style.display = 'block';
            }
            
            // Update header based on game mode
            gameModeHeader.textContent = gameMode === 'multiplayer' ? 'Multiplayer Word Game' : 'Single Player Word Game';
            
            // Update score
            scoreEl.textContent = score;
            
            // Clear guessed words
            guessedWordsEl.innerHTML = '';
        }
        
        // Start the game
        function startGame() {
            if (gameActive) return;
            
            gameActive = true;
            startButton.disabled = true;
            startButton.textContent = 'Game in Progress';
            
            if (gameMode === 'multiplayer' && isHost) {
                // Start the multiplayer game
                startMultiplayerGame();
            } else {
                // Single player game
                // Show words to describer
                if (playerRole === 'describer') {
                    wordsGridEl.style.display = 'grid';
                    populateWordsGrid();
                }
                
                // Start the timer
                startTimer();
            }
        }
        
        // Populate words grid for describer
        function populateWordsGrid() {
            wordsGridEl.innerHTML = '';
            
            // Select random words based on settings
            const gameWords = gameMode === 'multiplayer' ? 
                currentWords : 
                [...currentWords]
                    .sort(() => 0.5 - Math.random())
                    .slice(0, gameSettings.wordCount);
            
            gameWords.forEach(word => {
                const wordEl = document.createElement('div');
                wordEl.className = 'word-card';
                wordEl.textContent = word;
                wordEl.dataset.word = word;
                wordEl.onclick = function() {
                    if (gameActive) {
                        this.classList.add('correct');
                        
                        if (gameMode === 'multiplayer') {
                            // Update in Firebase
                            const newGuessedWords = [...guessedWords, word];
                            gameRef.update({
                                guessedWords: newGuessedWords,
                                score: score + 10
                            });
                        } else {
                            // Single player
                            score += 10;
                            scoreEl.textContent = score;
                            
                            // Add to guessed words display
                            const guessedWordEl = document.createElement('div');
                            guessedWordEl.className = 'word-card correct';
                            guessedWordEl.textContent = word;
                            guessedWordsEl.appendChild(guessedWordEl);
                            
                            // Check if all words have been guessed
                            const correctWords = document.querySelectorAll('.word-card.correct').length;
                            if (correctWords >= gameSettings.wordCount) {
                                endGame();
                            }
                        }
                    }
                };
                wordsGridEl.appendChild(wordEl);
            });
        }
        
        // Update guessed words for guesser
        function updateGuessedWords() {
            guessedWordsEl.innerHTML = '';
            
            guessedWords.forEach(word => {
                const guessedWordEl = document.createElement('div');
                guessedWordEl.className = 'word-card correct';
                guessedWordEl.textContent = word;
                guessedWordsEl.appendChild(guessedWordEl);
            });
        }
        
        // Start the timer
        function startTimer() {
            // Clear any existing timer
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Reset time left
            timeLeft = gameSettings.timerDuration;
            timerEl.textContent = `${timeLeft}s`;
            
            // Start the countdown
            timerInterval = setInterval(() => {
                timeLeft--;
                timerEl.textContent = `${timeLeft}s`;
                
                if (gameMode === 'multiplayer' && isHost) {
                    // Update time in Firebase
                    gameRef.update({
                        timeLeft: timeLeft
                    });
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    endGame();
                }
            }, 1000);
        }
        
        // Submit guess function
        function submitGuess() {
            if (!gameActive) {
                showNotification('The game has not started yet. Wait for the describer to start the game.', 'warning');
                return;
            }
            
            const guess = guessInput.value.trim().toLowerCase();
            
            if (!guess) {
                showNotification('Please enter a word', 'error');
                return;
            }
            
            // Clear input field
            guessInput.value = '';
            
            if (gameMode === 'multiplayer') {
                // Check if the word is in the current words list and not already guessed
                if (currentWords.includes(guess) && !guessedWords.includes(guess)) {
                    // Correct guess
                    const newGuessedWords = [...guessedWords, guess];
                    gameRef.update({
                        guessedWords: newGuessedWords,
                        score: score + 10
                    });
                    
                    showNotification(`Correct! +10 points`, 'success');
                    
                    // Check if all words have been guessed
                    if (newGuessedWords.length >= currentWords.length) {
                        endGame();
                    }
                } else if (guessedWords.includes(guess)) {
                    showNotification('This word has already been guessed!', 'info');
                } else {
                    showNotification('Not a valid word in the current list. Try again!', 'error');
                }
            } else {
                // Single player mode
                // Check if the word is in the current words list and not already guessed
                const wordElements = document.querySelectorAll('.word-card');
                let wordFound = false;
                
                wordElements.forEach(wordEl => {
                    const word = wordEl.dataset.word.toLowerCase();
                    if (word === guess && !guessedWords.includes(word)) {
                        // Correct guess
                        guessedWords.push(word);
                        score += 10;
                        scoreEl.textContent = score;
                        
                        // Add to guessed words display
                        const guessedWordEl = document.createElement('div');
                        guessedWordEl.className = 'word-card correct';
                        guessedWordEl.textContent = word;
                        guessedWordsEl.appendChild(guessedWordEl);
                        
                        // Mark as guessed in describer's view
                        wordEl.classList.add('correct');
                        
                        wordFound = true;
                        showNotification(`Correct! +10 points`, 'success');
                    }
                });
                
                if (wordFound) {
                    // Check if all words have been guessed
                    if (guessedWords.length >= gameSettings.wordCount) {
                        endGame();
                    }
                } else if (guessedWords.includes(guess)) {
                    showNotification('This word has already been guessed!', 'info');
                } else {
                    showNotification('Not a valid word in the current list. Try again!', 'error');
                }
            }
            
            guessInput.focus();
        }
        
        // Allow Enter key to submit guess
        guessInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                submitGuess();
            }
        });
        
        // Switch role function
        function switchRole() {
            if (gameMode === 'multiplayer') {
                // In multiplayer, we need to update our role in Firebase
                playerRole = playerRole === 'describer' ? 'guesser' : 'describer';
                playersRef.child(playerId).update({ role: playerRole });
                
                // Show notice about role switch
                roleSwitchNotice.style.display = 'block';
                setTimeout(() => {
                    roleSwitchNotice.style.display = 'none';
                }, 3000);
            } else {
                // Single player mode
                playerRole = playerRole === 'describer' ? 'guesser' : 'describer';
                
                // Update UI
                if (playerRole === 'describer') {
                    describerView.style.display = 'block';
                    guesserView.style.display = 'none';
                    
                    // If game is active, show the words
                    if (gameActive) {
                        wordsGridEl.style.display = 'grid';
                    }
                } else {
                    guesserView.style.display = 'block';
                    describerView.style.display = 'none';
                }
                
                // Show notice about role switch
                roleSwitchNotice.style.display = 'block';
                setTimeout(() => {
                    roleSwitchNotice.style.display = 'none';
                }, 3000);
            }
            
            // Update the player info
            playerInfoEl.textContent = `${playerName} - ${playerRole.charAt(0).toUpperCase() + playerRole.slice(1)}`;
            
            // Make sure timer is still running if game is active
            if (gameActive && !timerInterval) {
                startTimer();
            }
        }
        
        // Reset game function
        function resetGame() {
            // Clear the timer
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            if (gameMode === 'multiplayer') {
                // Leave the multiplayer game
                leaveGame();
            } else {
                // Single player reset
                gameActive = false;
                playerName = '';
                playerRole = '';
                document.getElementById('player-name').value = '';
                switchScreen('name-screen');
            }
        }
        
        // End the game
        function endGame() {
            gameActive = false;
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            if (gameMode === 'multiplayer' && isHost) {
                // Update game status in Firebase
                gameRef.update({
                    status: 'finished',
                    gameActive: false
                });
            }
            
            // Show game over notification
            gameOverMessage.textContent = `Game over! Your score: ${score} points. You guessed ${guessedWords.length} out of ${gameSettings.wordCount} words.`;
            gameOverNotification.style.display = 'block';
        }
        
        // Start a new game
        function startNewGame() {
            gameOverNotification.style.display = 'none';
            
            if (gameMode === 'multiplayer' && isHost) {
                // Reset multiplayer game
                gameRef.update({
                    status: 'waiting',
                    gameActive: false,
                    currentWords: [],
                    guessedWords: [],
                    score: 0,
                    timeLeft: gameSettings.timerDuration
                });
                
                // Switch back to lobby screen
                switchScreen('lobby-screen');
            } else {
                initializeGame();
            }
        }
        
        // Return to main menu
        function returnToMenu() {
            gameOverNotification.style.display = 'none';
            
            if (gameMode === 'multiplayer') {
                leaveGame();
            } else {
                resetGame();
            }
        }
        
        // Offline role selection functions
        function setOfflineRole(role) {
            localStorage.setItem('offlinePlayerRole', role);
            offlineRoleOverlay.style.display = 'none';
            applyOfflineRoleView(role);
        }
        
        function applyOfflineRoleView(role) {
            const describerView = document.getElementById('describer-view');
            const guesserView = document.getElementById('guesser-view');
            const wordsGrid = document.getElementById('words-grid');
            const guessInput = document.getElementById('guess-input');
            
            if (role === 'describer') {
                if (describerView) describerView.style.display = 'block';
                if (guesserView) guesserView.style.display = 'none';
                if (wordsGrid) wordsGrid.style.display = 'none';
            } else {
                if (describerView) describerView.style.display = 'none';
                if (guesserView) guesserView.style.display = 'block';
                if (guessInput) guessInput.value = '';
            }
        }
        
        // Add Enter key support for all screens
        function setupEnterKeySupport() {
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    // Mode screen
                    if (modeScreen.style.display === 'block') {
                        submitMode();
                    }
                    // Name screen
                    else if (nameScreen.style.display === 'block') {
                        submitName();
                    }
                    // Role screen
                    else if (roleScreen.style.display === 'block') {
                        submitRole();
                    }
                    // Offline role selection
                    else if (offlineRoleOverlay.style.display === 'flex') {
                        setOfflineRole('describer');
                    }
                }
            });
        }
        
        // Auto-apply saved role on load
        window.addEventListener('DOMContentLoaded', () => {
            const savedRole = localStorage.getItem('offlinePlayerRole');
            if (savedRole) {
                offlineRoleOverlay.style.display = 'none';
                applyOfflineRoleView(savedRole);
            }
            
            // Initialize the settings when page loads
            initSettings();
            
            // Setup Enter key support
            setupEnterKeySupport();
            
            // Add Enter support for player name input
            document.getElementById('player-name').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    submitName();
                }
            });
            
            // Add Enter support for join game ID input
            document.getElementById('join-game-id').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    joinGame();
                }
            });
        });
    </script>
</body>
</html>
